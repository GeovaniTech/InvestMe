<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:components="http://java.sun.com/jsf/composite/components">
	
	<h:head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>InvestMe</title>
	</h:head>
	
	<h:body>
		<ui:composition template="/template/layout.xhtml">
			<ui:define name="body">			
				<h:outputStylesheet library="css" name="card.css"/>
				<h:outputStylesheet library="css" name="expenditures.css"/>
								
				<h:panelGroup id="dashboard" class="container-cards">
					<ui:repeat var="type" value="#{MBType.typesExpenditure}">
						<components:card 
							description="#{type.name}"
							value="#{MBAppConfigs.getBrazilianCurrency(type.spents)}" />
					</ui:repeat>
				</h:panelGroup>
				
				<p:commandButton 
					value="New Expenditure"
					icon="pi pi-plus"
					onclick="PF('dialog-new-expenditure').show()"
					styleClass="ui-button-outlined ui-button-danger"
					style="margin-left: 10px; margin-bottom: 10px; background-color: white !important;" />
				
				<h:form id="tableTransactions">
					<p:dataTable
						value="#{MBExpenditure.expenditures}"
						var="transaction"
						paginator="true"
						rows="15"
						paginatorPosition="bottom"
						reflow="true">
						
						<p:column headerText="Active">
							<h:outputText value="#{transaction.active}" />
						</p:column>
		
						<p:column headerText="Type">
							<h:outputText value="#{transaction.typeActive.name}" />
						</p:column>
						
						<p:column headerText="Price">
							<h:outputText value="#{MBAppConfigs.getBrazilianCurrency(transaction.price)}" />
						</p:column>
						
						<p:column headerText="Payment">
							<h:outputText value="#{transaction.payment == null ? 'Not informed' : transaction.payment}" />
						</p:column>
		
						<p:column headerText="Amount">
							<h:outputText value="#{transaction.amount}" />
						</p:column>
		
						<p:column headerText="When">
							<h:outputText value="#{transaction.date}">
								<f:convertDateTime pattern="MM/dd/yyyy" />  
							</h:outputText>
						</p:column>
						
						<p:column headerText="Total">
							<h:outputText value="#{MBAppConfigs.getBrazilianCurrency(transaction.amount * transaction.price)}" />
						</p:column>
						
						<p:column headerText="Options">
							<p:commandButton 
								value="Edit"
								action="#{MBExpenditure.setToTransaction(transaction)}"
								oncomplete="PF('dialog-edit-expenditure').show()"
								update="dialog-edit-expenditure, :tableTransactions, growl, @form, dashboard"
								icon="pi pi-pencil" />
						
							<p:commandButton 
								value="Delete"
								action="#{MBExpenditure.remove(transaction)}"
								update=":tableTransactions, growl, @form, dashboard"
								icon="pi pi-times" />
						</p:column>				
					</p:dataTable>
				</h:form>
				
				<p:dialog
					id="dialog-edit-expenditure"
					header="Transactions"
					widgetVar="dialog-edit-expenditure"
					styleClass="dialog-expenditure">
					
					<h:form>
						<div class="panel-inputs">
							<p:inputText 
								placeholder="Active"
								value="#{MBExpenditure.toTransaction.active}"
								styleClass="campo" />
							
							<p:inputNumber 
								placeholder="Price"
								value="#{MBExpenditure.toTransaction.price}" 
								styleClass="campo"/>
							
							<p:inputNumber 
								placeholder="Amount"
								value="#{MBExpenditure.toTransaction.amount}"
								styleClass="campo" />
							
							<p:datePicker 
								placeholder="When"
								value="#{MBExpenditure.toTransaction.date}"
								styleClass="campo" />
							
							<p:selectOneMenu value="#{MBExpenditure.toTransaction.payment}">
								<f:selectItem 
									itemLabel="Pix"
									itemValue="Pix" />
									
								<f:selectItem 
									itemLabel="Money"
									itemValue="Money" />
									
								<f:selectItem 
									itemLabel="Credit Card"
									itemValue="Credit Card" />
								
								<f:selectItem 
									itemLabel="Debit Card"
									itemValue="Debit Card" />
								
								<f:selectItem
									itemLabel="Ticket"
									itemValue="Ticket" />								
								
								<f:selectItem 
									itemLabel="Transaction"
									itemValue="Transaction" />								
							</p:selectOneMenu>
							
							<p:selectOneMenu value="#{MBExpenditure.convertId}" styleClass="campo">
								<f:selectItems 
									var="type"
									value="#{MBType.typesExpenditure}"
									itemLabel="#{type.name}"
									itemValue="#{type.id}" />
							</p:selectOneMenu>					
						</div>
						
						<p:commandButton 
							value="Save"
							action="#{MBExpenditure.change()}"
							icon="pi pi-check"
							update="growl, :tableTransactions, dashboard"
							style="width: 100%;" />
					</h:form>				
				</p:dialog>
				
				<!-- DIALOG TRANSACTION -->
				<p:dialog
					header="Transactions"
					widgetVar="dialog-new-expenditure"
					styleClass="dialog-expenditure">
					
					<h:form>
						<div class="panel-inputs">
							<p:inputText 
								placeholder="Active"
								value="#{MBExpenditure.toTransaction.active}"
								styleClass="campo" />
							
							<p:inputNumber 
								placeholder="Price"
								value="#{MBExpenditure.toTransaction.price}" 
								styleClass="campo"/>
							
							<p:inputNumber 
								placeholder="Amount"
								value="#{MBExpenditure.toTransaction.amount}"
								styleClass="campo" />
							
							<p:datePicker 
								placeholder="When"
								value="#{MBExpenditure.toTransaction.date}"
								styleClass="campo" />
							
							<p:selectOneMenu value="#{MBExpenditure.toTransaction.payment}">
								<f:selectItem 
									itemLabel="Pix"
									itemValue="Pix" />
									
								<f:selectItem 
									itemLabel="Money"
									itemValue="Money" />
									
								<f:selectItem 
									itemLabel="Credit Card"
									itemValue="Credit Card" />
								
								<f:selectItem 
									itemLabel="Debit Card"
									itemValue="Debit Card" />
								
								<f:selectItem
									itemLabel="Ticket"
									itemValue="Ticket" />								
								
								<f:selectItem 
									itemLabel="Transaction"
									itemValue="Transaction" />								
							</p:selectOneMenu>
							
							<p:selectOneMenu value="#{MBExpenditure.convertId}" styleClass="campo">
								<f:selectItems 
									var="type"
									value="#{MBType.typesExpenditure}"
									itemLabel="#{type.name}"
									itemValue="#{type.id}" />
							</p:selectOneMenu>					
						</div>
						
						<p:commandButton 
							value="Save"
							action="#{MBExpenditure.save()}"
							icon="pi pi-check"
							update="growl, :tableTransactions, dashboard"
							style="width: 100%;" />
					</h:form>
				</p:dialog>		
			</ui:define>
		</ui:composition>
	</h:body>
</html>
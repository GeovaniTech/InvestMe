<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:components="http://java.sun.com/jsf/composite/components"
	xmlns:jsf="http://xmlns.jcp.org/jsf">

<h:body>
	<ui:composition template="/templates/layout.xhtml">
		<ui:define name="name_page">
			<h:outputText value="#{label.home}" />
		</ui:define>

		<ui:define name="body">
			<h:outputStylesheet library="css" name="/client/home/home.css" />
			
			<div jsf:id="charts" class="horizontal-evenly">
				<div class="vertical-center" style="display: #{MBChartInvestments.hasData ? 'flex' : 'none'}">
					<ui:include src="/htdocs/client/investments/chart_investments_by_category.xhtml" />
					<p class="mg-t-10">#{MBAppConfigs.appConfigs.showValues ? MBAppConfigs.getBrazilianCurrency(MBHome.getTotalInvestment()) : '******'}</p>
				</div>
				
				<div class="vertical-center" style="display: #{MBChartExpenditures.hasData ? 'flex' : 'none'}">
					<ui:include src="/htdocs/client/expenditures/chart_expenditures_by_category.xhtml" />
					<p class="mg-t-10">#{MBAppConfigs.appConfigs.showValues ? MBAppConfigs.getBrazilianCurrency(MBHome.getTotalExpense()) : '******'}</p>
				</div>
			</div>
			
			<h:form id="formTransactions">
				<p:remoteCommand 
					name="updateTableAndCards"
					update="formTransactions:tableTransactions, :charts" />
		
				<h2>#{label.last_transactions}</h2>
		
				<div class="top-buttons mg-b-10">
					<p:commandButton 
						id="btnInitNewTransaction"
						action="#{MBHome.initTransaction()}"
						oncomplete="PF('dialogTransactionInfoVW').show();"
						icon="pi pi-plus" 
						styleClass="optionsButtonStyle mg-r-5" />
					
					<p:commandButton 
						id="btnFiltersTransactions"
						icon="pi pi-filter" 
						styleClass="optionsButtonStyle mg-r-10" />
						
					<p:commandButton 
						id="btnOpenChart"
						action="#{MBChartSpents.createChartSpents}"
						update="dialogChartSpents:formChartSpents"
						oncomplete="PF('chartSpentsVW').show();"
						icon="pi pi-chart-line" 
						styleClass="optionsButtonStyle mg-r-10" />
				</div>
				
				<p:overlayPanel id="overlayFilters" for="btnFiltersTransactions">
					<div class="horizontal-left-center">
						<div class="search-group">
							<components:inputFilter 
								label="#{label.active}"
								toInputFilter="#{MBHome.filter.active}" />
						</div>
						
						<div class="search-group">
							<components:dateRange 
								label="#{label.purchase_date}"
								toInputDateFilter="#{MBHome.filter.datePurchase}" />
						</div>
					</div>
					
					<div class="horizontal-left-center">
						<div class="search-group">
							<components:numberRange 
								label="#{label.price}"
								toInputNumberFilter="#{MBHome.filter.price}" />
						</div>
						
						<div class="search-group">
							<p:outputLabel for="category" value="#{label.category}" />
							<p:selectOneMenu 
								id="category"
								value="#{MBHome.filter.idCategory}"
								style="width: 200px;">
							
								<f:selectItem 
									itemLabel="#{label.all}" 
									itemValue="#{null}"/>							
								
								<f:selectItems 
									var="category"
									value="#{MBHome.categories}"
									itemLabel="#{category.name}"
									itemValue="#{category.id}" />
							</p:selectOneMenu>
						</div>

						<div class="search-group">
							<p:outputLabel for="payment" value="#{label.payment}" />
							<p:selectOneMenu 
								id="payment"
								value="#{MBHome.filter.idPayment}"
								style="width: 200px;">
								
								<f:selectItem 
									itemLabel="#{label.all}" 
									itemValue="#{null}"/>
								
								<f:selectItems 
									var="payment"
									value="#{MBHome.payments}"
									itemLabel="#{payment.name}"
									itemValue="#{payment.id}" />
							</p:selectOneMenu>
						</div>
					</div>
					
					<p:toolbar>
						<f:facet name="left">
							<p:commandButton 
								id="btnSearchResults" 
								icon="pi pi-search"
								value="#{label.search}"
								update="@form"
								onclick="PF('tableTransactionsVW').filter();"
								oncomplete="reloadChartInvestments(); reloadChartExpenditures();" 
								styleClass="mg-r-5" />

							<p:commandButton 
								icon="pi pi-filter-slash"
								value="#{label.clear_filters}" 
								oncomplete="reloadChartInvestments(); reloadChartExpenditures();" 
								action="#{MBHome.clearFilters}"
								update="@form" />
						</f:facet>
					</p:toolbar>
					
					<p:defaultCommand target="btnSearchResults" />
				</p:overlayPanel>
				
				<p:dataTable
					id="tableTransactions"
					var="to" 
					widgetVar="tableTransactionsVW"
					value="#{MBHome.results}"
					rowKey="#{to.id}"
					rows="20"
					paginator="true" 
	               	paginatorPosition="top"
	                lazy="true"
	                selection="#{MBHome.transaction}"
	                selectionMode="single"
	                rowStyleClass="#{to.category.type eq 'investment' ? 'row-investment' : 'row-expense'}">
	                
	                <p:ajax 
	                	event="rowSelect" 
	                	listener="#{MBHome.onRowSelect}"
	                	oncomplete="PF('dialogTransactionInfoVW').show();" />
					
					<p:column headerText="#{label.active}">
						<h:outputText value="#{to.active}"/>
					</p:column>
					
					<p:column headerText="#{label.category}">
						<h:outputText value="#{to.category.name}" />
					</p:column>
					
					<p:column headerText="#{label.purchase_date}">
						<h:outputText value="#{to.datePurchase}">
							<f:convertDateTime pattern="dd/MM/yyyy"/>
						</h:outputText>
					</p:column>
					
					<p:column headerText="#{label.price}">
						<h:outputText value="#{MBAppConfigs.appConfigs.showValues ? MBAppConfigs.getBrazilianCurrency(to.price) :  '******'}" />
					</p:column>
					
					<p:column headerText="#{label.total}">
						<h:outputText value="#{MBAppConfigs.appConfigs.showValues ? MBAppConfigs.getBrazilianCurrency(to.price * to.amount) :  '******'}" />
					</p:column>
					
					<p:column headerText="#{label.amount}">
						<h:outputText value="#{to.amount}" />
					</p:column>

					<p:column headerText="#{label.payment}">
						<h:outputText value="#{to.payment.name}" />
					</p:column>
				</p:dataTable>
			</h:form>
			
			<ui:include src="/htdocs/client/transaction/transaction_info.xhtml" />
			<ui:include src="/htdocs/client/home/chart_spents.xhtml" />
		</ui:define>
	</ui:composition>
</h:body>
</html>